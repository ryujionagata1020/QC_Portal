<!DOCTYPE html>
<html lang="ja">
  <head>
    <%- include("../_share/metadata.ejs") %>
    <title>お問い合わせ | QC-Portal</title>
    <link rel="stylesheet" href="https://unpkg.com/ress/dist/ress.min.css" />
    <link rel="stylesheet" href="/public/index.css" />
  </head>
  <body>
    <div id="site-wrapper">
      <%- include("../_share/navbar.ejs") %>

      <main id="main-content" class="contact-page" role="main">
        <div class="contact-container">
          <nav class="contact-breadcrumb" aria-label="パンくずリスト">
            <a href="/">ホーム</a>
            <span aria-hidden="true">&rsaquo;</span>
            <span aria-current="page">お問い合わせ</span>
          </nav>

          <h1 class="contact-page-title">お問い合わせ</h1>
          <p class="contact-description">
            ご質問・バグ報告・ご要望などはこちらからお送りください。<br>
            内容を確認の上、メールにてご返信いたします。
          </p>

          <% if (errors && errors.length > 0) { %>
            <div class="contact-error-box" role="alert">
              <ul>
                <% errors.forEach(function(e) { %>
                  <li><%= e %></li>
                <% }); %>
              </ul>
            </div>
          <% } %>

          <form
            class="contact-form"
            method="POST"
            action="/contact"
            novalidate
          >
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <!-- ハニーポット（Botスパム対策）: CSSで非表示、人間は入力しない -->
            <input
              type="text"
              name="website"
              value=""
              tabindex="-1"
              autocomplete="off"
              aria-hidden="true"
              style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden;"
            >

            <div class="contact-field">
              <label class="contact-label" for="contact-name">
                お名前 <span class="contact-required">必須</span>
              </label>
              <input
                class="contact-input"
                type="text"
                id="contact-name"
                name="name"
                value="<%= form.name || '' %>"
                maxlength="100"
                required
                autocomplete="name"
                placeholder="例：山田 太郎"
              >
            </div>

            <div class="contact-field">
              <label class="contact-label" for="contact-email">
                メールアドレス <span class="contact-required">必須</span>
              </label>
              <input
                class="contact-input"
                type="email"
                id="contact-email"
                name="email"
                value="<%= form.email || '' %>"
                maxlength="254"
                required
                autocomplete="email"
                placeholder="例：example@email.com"
              >
            </div>

            <div class="contact-field">
              <label class="contact-label" for="contact-category">
                お問い合わせ種別 <span class="contact-required">必須</span>
              </label>
              <select
                class="contact-select"
                id="contact-category"
                name="category"
                required
              >
                <option value="" disabled <%= !form.category ? 'selected' : '' %>>選択してください</option>
                <option value="bug"     <%= form.category === 'bug'     ? 'selected' : '' %>>バグ・不具合報告</option>
                <option value="feature" <%= form.category === 'feature' ? 'selected' : '' %>>機能・改善要望</option>
                <option value="usage"   <%= form.category === 'usage'   ? 'selected' : '' %>>使い方の質問</option>
                <option value="other"   <%= form.category === 'other'   ? 'selected' : '' %>>その他</option>
              </select>
            </div>

            <div class="contact-field">
              <label class="contact-label" for="contact-subject">
                件名 <span class="contact-required">必須</span>
              </label>
              <input
                class="contact-input"
                type="text"
                id="contact-subject"
                name="subject"
                value="<%= form.subject || '' %>"
                maxlength="200"
                required
                placeholder="例：〇〇ページの表示がおかしい"
              >
            </div>

            <div class="contact-field">
              <label class="contact-label" for="contact-message">
                お問い合わせ内容 <span class="contact-required">必須</span>
              </label>
              <textarea
                class="contact-textarea"
                id="contact-message"
                name="message"
                maxlength="2000"
                rows="8"
                required
                placeholder="お問い合わせ内容を詳しくご記入ください（2000文字以内）"
              ><%= form.message || '' %></textarea>
              <div class="contact-char-count">
                <span id="message-count">0</span> / 2000 文字
              </div>
            </div>

            <div class="contact-actions">
              <button type="submit" class="contact-btn-submit">確認画面へ</button>
            </div>
          </form>
        </div>
      </main>

      <%- include("../_share/footer.ejs") %>
    </div>

    <script>
      (function () {
        var textarea = document.getElementById('contact-message');
        var counter  = document.getElementById('message-count');
        if (!textarea || !counter) return;
        function updateCount() {
          counter.textContent = textarea.value.length;
        }
        textarea.addEventListener('input', updateCount);
        updateCount();
      })();
    </script>
  </body>
</html>
